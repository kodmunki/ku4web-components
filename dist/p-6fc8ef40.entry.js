import{r as i,c as t,h as s,H as h,g as a}from"./p-f134bec3.js";import{t as e,h as n,Y as r,R as l}from"./p-54fb5b7d.js";const d=class{constructor(s){i(this,s),this.didValidate=t(this,"validate",7),this.pattern=".*",this.flags="",this.method="";const h=this.pattern.split(" "),a=this.flags.split(" "),n=e.isString(this.method)?this.method.trim():this.method;this.regex=h.map(((i,t)=>new RegExp(i,a[t]))),this.validationMethod=e.isNullOrEmpty(n)?()=>!0:e.isString(n)?new Function("value, values",/^return/.test(n)?n:`return ${n}`):e.isFunction(n)?n:()=>!0,this.handleInput=this.handleInput.bind(this),this.handleChange=this.handleChange.bind(this),this.handleBlur=this.handleBlur.bind(this),this.handleReset=this.handleReset.bind(this)}async validate(){return await this.assert()}async handleInput({target:i}){("file"===i.type||e.isFalse(this.isValid))&&await this.assert()}async handleChange({target:i}){("file"===i.type||e.isFalse(this.isValid))&&await this.assert()}async handleBlur(){await this.assert()}handleReset(){this.isValid=!0,this.invalid=!this.isValid,this.input&&this.input.setAttribute("aria-invalid",this.invalid)}async assert(){const{ele:i,validOptions:t,inputs:s,input:h,regex:a,checked:r}=this,l=this.isValid,d=await n.async((async()=>await this.ku4Form.read()),{});if(this.disabled)this.isValid=!0;else{const n=async s=>{if("file"===s.type&&e.isNullOrEmpty(s.value))return!0;const h=e.isBool(r)?s.checked===r:(n=a,l=s.value,c=i,((o=t)?o.some((i=>i===l))&&(n||[]).every((i=>i.test(l))):c?c.value===l&&(n||[]).every((i=>i.test(l))):(n||[]).every((i=>i.test(l))))&&await this.validationMethod(s.value,d));var n,l,o,c;return s.setAttribute("aria-invalid",!h),h};this.isValid=s?!(await Promise.all(s.map((i=>n(i))))).some((i=>!i)):!h||await n(h)}return e.isFalse(l)&&this.isValid&&this.didValidate.emit(this.isValid),this.invalid=!this.isValid,this.isValid}componentWillLoad(){const i=this.for.replace(/\s/g,"").replace(/,/g,",#");if(this.inputs=/,/.test(this.for)&&Array.from(document.querySelectorAll(`#${i}`)),this.input=!/,/.test(this.for)&&document.getElementById(this.for),this.ele=document.getElementById(this.element)||document.querySelector(this.element),this.validOptions=e.exists(this.values)?this.values.split(","):this.ele&&"DATALIST"===this.ele.nodeName&&[].slice.call(this.ele.querySelectorAll("option")).map((i=>i.value)),e.isFunction(this.host.closest)&&(this.ku4Form=this.host.closest("ku4-form"),this.form=this.host.closest("form"),this.form&&this.form.addEventListener&&this.form.addEventListener("reset",this.handleReset)),this.inputs)r(0).then((()=>{this.inputs.forEach((i=>{i.addEventListener("input",this.handleInput),i.addEventListener("change",this.handleChange),i.addEventListener("blur",this.handleBlur)}))}));else if(this.input){const i=this.input.getAttribute("aria-describedby"),t=this.host.getAttribute("id")||l.uid();this.host.setAttribute("id",t),e.isNullOrEmpty(i)&&this.input.setAttribute("aria-describedby",t),r(0).then((()=>{this.input.addEventListener("input",this.handleInput),this.input.addEventListener("change",this.handleChange),this.input.addEventListener("blur",this.handleBlur)}))}else console.error("ku4-validation must have a valid `for` referencing target field `id`.")}disconnectedCallback(){this.inputs&&this.inputs.forEach((i=>{i&&i.removeEventListener&&(i.removeEventListener("input",this.handleInput),i.removeEventListener("change",this.handleChange),i.removeEventListener("blur",this.handleBlur))})),this.input&&this.input.removeEventListener&&(this.input.removeEventListener("input",this.handleInput),this.input.removeEventListener("change",this.handleChange),this.input.removeEventListener("blur",this.handleBlur)),this.form&&this.form.removeEventListener&&this.form.removeEventListener("reset",this.handleReset)}render(){return s(h,{role:"alert","aria-live":"assertive"},s("slot",null))}get host(){return a(this)}};d.style=":host{visibility:hidden !important}:host([invalid]){visibility:visible !important}:host([disabled]){visibility:hidden !important}:host([invalid][disabled]){visibility:hidden !important}:host([invalid][hidden]){visibility:hidden !important}";export{d as ku4_validation}