import{r as t,c as s,h as i,g as h}from"./p-42dd73f2.js";import{Y as e,t as a}from"./p-b4f47084.js";import{i as r}from"./p-16f6027a.js";const n=class{constructor(i){t(this,i),this.didValidate=s(this,"validate",7),this.validate=this.validate.bind(this),this.handleReset=this.handleReset.bind(this)}async listFieldNames(){return r.readFieldNames(this.form)}async validate(){const{fields:t}=this,s=t.map((t=>t.validate()));return this.isValid=await Promise.all(s).then((t=>!t.some((t=>!1===t)))),this.valid=this.isValid,this.invalid=!this.isValid,await e(100).then((()=>this.host.querySelectorAll("ku4-validation[invalid]"))).then((t=>this.didValidate.emit({invalid:t}))),this.isValid}async invalidate(t){if(a.isArray(t))t.forEach((t=>{const s=this.fields.find((s=>s.for===t));s&&(s.invalid=!0)}));else{const s=this.fields.find((s=>s.for===t));s&&(s.invalid=!0)}return this.isValid=!1,this.valid=this.isValid,this.invalid=!this.isValid,this}async read(){return r.read(this.form)}async write(t){return r.write(this.form,t),Object.keys(t).forEach((t=>{try{this.form.querySelector(`[name="${t}"]`).dispatchEvent(new window.Event("change"))}catch(s){}})),this}get form(){return this.host.querySelector("form")}get fields(){return[].slice.call(this.form.querySelectorAll("ku4-validation"))}handleReset(){this.isValid=!0,this.valid=this.isValid,this.invalid=!this.isValid}componentWillLoad(){const{form:t}=this;if(a.exists(t)){const s=t.onsubmit||(()=>{});t.onsubmit=i=>(i.preventDefault(),this.validate().then((h=>h&&s.call(t,i))).then((s=>!a.isFalse(s)&&t.submit())),!1),t.addEventListener("reset",this.handleReset),this.fields.forEach((t=>t.addEventListener("validated",this.validate)))}}disconnectedCallback(){const{form:t}=this;a.exists(t)&&(t.removeEventListener("reset",this.handleReset),this.fields.forEach((t=>t.removeEventListener("validated",this.validate))))}render(){return i("slot",null)}get host(){return h(this)}};export{n as ku4_form}