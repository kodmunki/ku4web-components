import{r as t,h as i,g as s}from"./p-ae5b4572.js";import{c as h}from"./p-545305c8.js";import{u as e,o as n}from"./p-57f65d5f.js";const a=(t,i)=>{t.forEach(i?t=>{t.currentAriaHidden=t.getAttribute("aria-hidden"),t.setAttribute("aria-hidden",i)}:t=>{t.currentAriaHidden?t.setAttribute("aria-hidden",t.currentAriaHidden):t.removeAttribute("aria-hidden")})},r=["A","BUTTON","INPUT","SELECT","TEXTAREA"],o=t=>[].slice.call(t.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')),d=class{constructor(i){t(this,i),this.active=!1,this.include="null",this.exclude="null",this.initial="null",this.return="null",this.handleKeyDown=this.handleKeyDown.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this),this.handleMouse=this.handleMouse.bind(this)}activeHandler(t){t?this.handleActivate():this.handleDeactivate()}async activate(t){this.lastActiveElement=t||document.querySelector(this.return),this.active=!0}async deactivate(){this.active=!1}handleActivate(){this.lastActiveElement=this.lastActiveElement||document.activeElement,this.addEventListeners(this.elements),this.activateTraps(),a(this.outerElements,!0),window.requestAnimationFrame(()=>(document.querySelector(this.initial)||this.focusableElements[0]).focus())}handleDeactivate(){this.removeEventListeners(this.elements),this.deactivateTraps(),a(this.outerElements),this.lastActiveElement.focus(),this.lastActiveElement=null}handleKeyDown(t){if(e.tab.didFire(t)){const i=this.trapElements.indexOf(t.target);if(0===i&&t.shiftKey)return this.focusableElements[this.focusableElements.length-1].focus(),n.mute(t);if(i===this.trapElements.length-1&&!t.shiftKey)return this.focusableElements[0].focus(),n.mute(t)}}handleKeyUp(t){if(e.tab.didFire(t)){const i=this.trapElements.indexOf(t.target);if(0===i&&t.shiftKey)return this.focusableElements[this.focusableElements.length-1].focus(),n.mute(t);if(i===this.trapElements.length-1&&!t.shiftKey)return this.focusableElements[0].focus(),n.mute(t)}}handleMouse(t){this.elements.some(i=>i===t.target)||n.mute(t)}addEventListeners(t){t.forEach(t=>t.addEventListener("keydown",this.handleKeyDown,!0)),t.forEach(t=>t.addEventListener("keypress",n.mute,!0)),t.forEach(t=>t.addEventListener("keyup",this.handleKeyUp,!0)),window.addEventListener("click",this.handleMouse,!0),window.addEventListener("mousedown",this.handleMouse,!0),window.addEventListener("mouseup",this.handleMouse,!0)}removeEventListeners(t){t.forEach(t=>t.removeEventListener("keydown",this.handleKeyDown,!0)),t.forEach(t=>t.removeEventListener("keypress",n.mute,!0)),t.forEach(t=>t.removeEventListener("keyup",this.handleKeyUp,!0)),window.removeEventListener("click",this.handleMouse,!0),window.removeEventListener("mousedown",this.handleMouse,!0),window.removeEventListener("mouseup",this.handleMouse,!0)}activateTraps(){this.setTraps(0)}deactivateTraps(){this.setTraps(-1)}setTraps(t){[].slice.call(this.host.querySelectorAll("[ku4-focus-trap], [ku4-focus-wrap]")).forEach(i=>i.setAttribute("tabindex",t))}wrap(t){const i=document.createDocumentFragment();i.appendChild(this.createWrapTag()),i.appendChild(t.cloneNode()),i.appendChild(this.createWrapTag()),t.parentNode.replaceChild(i,t)}createTrapTag(){return this.createTag("ku4-focus-trap")}createWrapTag(){return this.createTag("ku4-focus-wrap")}createTag(t){const i=document.createElement("a");return i.setAttribute(t,""),i.setAttribute("tabindex","0"),i.setAttribute("aria-hidden","true"),i.style.position="static",i.style.display="inline",i.style.margin="0",i.style.outline="none",i}initialize(){const t=[].slice.call(this.host.querySelectorAll("*")),i=[].slice.call(document.querySelectorAll(this.include)||[]),s=[].slice.call(document.querySelectorAll(this.exclude)||[]);var e;this.host.querySelectorAll("iframe").forEach(t=>this.wrap(t)),this.elements=h([...(e=this.host,[].slice.call(e.querySelectorAll(':not([tabindex="-1"])'))),...i]),this.focusableElements=this.elements.reduce((t,i)=>((t=>{const i=t.getAttribute("tabindex");return(r.includes(t.tagName.toUpperCase())||t.getAttribute("href"))&&(!i||isNaN(i)||parseInt(i)>-1)})(i)&&t.push(i),t),[]),this.focusableElements.shift(),this.focusableElements.pop(),this.outerElements=[...o(document.body),...s].filter(s=>!(s===this.host||t.includes(s)||i.includes(s)))}componentWillLoad(){const t=this.createTrapTag(),i=this.createTrapTag();this.trapElements=[t,i],this.host.insertBefore(t,this.host.firstChild),this.host.appendChild(i)}componentDidLoad(){this.initialize(),this.active&&this.handleActivate()}componentDidUnload(){this.active&&this.handleDeactivate()}render(){return i("slot",null)}get host(){return s(this)}static get watchers(){return{active:["activeHandler"]}}};d.style=":host{position:static}";export{d as ku4_focus_trap}