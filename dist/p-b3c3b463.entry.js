import{r as t,h as s,g as i}from"./p-e6b3a708.js";import{t as h,o as e}from"./p-b4f47084.js";import{E as n,K as a}from"./p-ba9edd72.js";const r=(t,s)=>{t.forEach(s?t=>{t.currentAriaHidden=t.getAttribute("aria-hidden"),t.setAttribute("aria-hidden",s)}:t=>{t.currentAriaHidden?t.setAttribute("aria-hidden",t.currentAriaHidden):t.removeAttribute("aria-hidden")})},o=["A","BUTTON","INPUT","SELECT","TEXTAREA"],c=t=>[].slice.call(t.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')),{tab:u}=a,d=a.tab.shift,p=a.tab.alt,l=a.tab.alt.shift,w=class{constructor(s){t(this,s),this.iframes=[],this.active=!1,this.handleKeyDown=this.handleKeyDown.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this),this.handleMouse=this.handleMouse.bind(this)}activeHandler(t){t?this.handleActivate():this.handleDeactivate()}async activate(t){this.lastActiveElement=t||document.querySelector(this.return||null),this.active=!0}async deactivate(){this.active=!1}handleActivate(){this.lastActiveElement=this.lastActiveElement||document.activeElement,this.lastActiveElement&&this.lastActiveElement.blur&&this.lastActiveElement.blur(),this.addEventListeners(this.elements),r(this.outerElements,!0),window.requestAnimationFrame((()=>{const t=document.querySelector(this.initial||null)||this.focusableElements[0]||this.trapElements[0];t.blur(),t.focus(),this.activateTraps()}))}handleDeactivate(){this.removeEventListeners(this.elements),this.deactivateTraps(),r(this.outerElements),this.lastActiveElement&&this.lastActiveElement.focus&&this.lastActiveElement.focus(),this.lastActiveElement=null}handleKeyDown(t){if(d.didFire(t)||l.didFire(t))try{if(this.iframes.length>0&&(this.trapElements[1]===t.target||!h.isNull(t.target.getAttribute("ku4-focus-wrap"))||this.iframes.some((s=>s.contains(t.target)))))return;if(this.trapElements[0]===t.target)return this.trapElements[1].focus(),n.mute(t);const s=this.focusableElements.indexOf(t.target)-1;return this.focusableElements[s<0?this.focusableElements.length-1:s].focus(),n.mute(t)}catch(t){return n.mute(t)}if(u.didFire(t)||p.didFire(t))try{if(this.iframes.length>0&&(this.trapElements[0]===t.target||!h.isNull(t.target.getAttribute("ku4-focus-wrap"))||this.iframes.some((s=>s.contains(t.target)))))return;if(this.trapElements[1]===t.target)return this.trapElements[0].focus(),n.mute(t);const s=this.focusableElements.indexOf(t.target)+1;return this.focusableElements[s>=this.focusableElements.length?0:s].focus(),n.mute(t)}catch(t){return n.mute(t)}}handleKeyUp(t){const s=this.trapElements.indexOf(t.target);return 0===s&&(d.didFire(t)||l.didFire(t))?((this.focusableElements[this.focusableElements.length-1]||this.trapElements[1]).focus(),n.mute(t)):1===s&&(u.didFire(t)||p.didFire(t))?((this.focusableElements[0]||this.trapElements[0]).focus(),n.mute(t)):void 0}handleMouse(t){this.elements.some((s=>s===t.target))||n.mute(t)}addEventListeners(t){t.forEach((t=>t.addEventListener("keydown",this.handleKeyDown,{passive:!0}))),t.forEach((t=>t.addEventListener("keyup",this.handleKeyUp,{passive:!0}))),window.addEventListener("click",this.handleMouse,{passive:!0}),window.addEventListener("mousedown",this.handleMouse,{passive:!0}),window.addEventListener("mouseup",this.handleMouse,{passive:!0}),window.addEventListener("touchstart",this.handleMouse,{passive:!0})}removeEventListeners(t){t.forEach((t=>t.removeEventListener("keydown",this.handleKeyDown,!0))),t.forEach((t=>t.removeEventListener("keyup",this.handleKeyUp,!0))),window.removeEventListener("click",this.handleMouse,!0),window.removeEventListener("mousedown",this.handleMouse,!0),window.removeEventListener("mouseup",this.handleMouse,!0),window.addEventListener("touchstart",this.handleMouse,!0)}activateTraps(){this.setTraps(0)}deactivateTraps(){this.setTraps(-1)}setTraps(t){[].slice.call(this.host.querySelectorAll("[ku4-focus-trap], [ku4-focus-wrap]")).forEach((s=>s.setAttribute("tabindex",t)))}wrap(t){const s=document.createDocumentFragment();s.appendChild(this.createWrapTag()),s.appendChild(t.cloneNode()),s.appendChild(this.createWrapTag()),t.parentNode.replaceChild(s,t)}createTrapTag(){return this.createTag("ku4-focus-trap")}createWrapTag(){return this.createTag("ku4-focus-wrap")}createTag(t){const s=document.createElement("button");return s.setAttribute(t,""),s.setAttribute("tabindex","0"),s.setAttribute("aria-hidden","true"),s.style.position="static",s.style.display="block",s.style.width="0",s.style.height="0",s.style.margin="0",s.style.padding="0",s.style.border="none",s.style.outline="none",s}initialize(){const t=[].slice.call(this.host.querySelectorAll("*")),s=[].slice.call(document.querySelectorAll(this.include||null)||[]),i=[].slice.call(document.querySelectorAll(this.exclude)||[]);let n=[];var a;(this.excludeShadow||"").split(",").forEach((t=>{if(!h.isNullOrEmpty(t))try{const s=t.trim().replace(/\s/,"|").split("|"),i=document.querySelector(s[0]).shadowRoot.querySelectorAll(s[1]);n=n.concat([].slice.call(i||[]))}catch(s){console.error("Invalid shadow selector",t)}})),this.iframes=[].slice.call(this.host.querySelectorAll("iframe")||[]),this.iframes.forEach((t=>this.wrap(t))),this.elements=e([...(a=this.host,[].slice.call(a.querySelectorAll(':not([tabindex="-1"])'))),...s]),this.focusableElements=this.elements.reduce(((t,s)=>((t=>{const s=t.getAttribute("tabindex");return(o.includes(t.tagName.toUpperCase())||t.getAttribute("href"))&&(!s||isNaN(s)||parseInt(s)>-1)})(s)&&!this.trapElements.includes(s)&&t.push(s),t)),[]),this.outerElements=[...c(document.body),...i,...n].filter((i=>!(i===this.host||t.includes(i)||s.includes(i))))}componentDidLoad(){const t=this.createTrapTag(),s=this.createTrapTag();this.trapElements=[t,s],this.host.insertBefore(t,this.host.firstChild),this.host.appendChild(s),this.initialize(),this.active?this.handleActivate():this.handleDeactivate()}disconnectedCallback(){this.active&&this.handleDeactivate()}render(){return s("slot",null)}get host(){return i(this)}static get watchers(){return{active:["activeHandler"]}}};w.style=":host{position:static}";export{w as ku4_focus_trap}