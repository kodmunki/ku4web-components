import{r as t,h as s}from"./p-80e7f1ae.js";import{c as i,u as h,t as e,Z as n}from"./p-ce48150b.js";const o=class{constructor(s){t(this,s),this.charIndexes=[],this.reverseCharIndexes=[],this.previousValue="",this.currentValue="",this.mouseDown=!1,this.touchStart=!1,this.template="",this.ban="",this.pattern="",this.char="_",this.hidden=!1,this.handleFocus=this.handleFocus.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleInput=this.handleInput.bind(this),this.handleMouseDown=this.handleMouseDown.bind(this),this.handleTouchStart=this.handleTouchStart.bind(this),this.init()}init(){return this.charIndexes=this.template.split("").reduce((t,s,i)=>(s===this.char&&t.push(i),t),[]),this.reverseCharIndexes=[...this.charIndexes].reverse(),this.banned=this.ban&&new RegExp(this.ban),this.regex=this.pattern&&this.pattern.substr(1).split(this.pattern[0]).map(t=>t&&new RegExp(t)||null),this}templateHandler(t,s){const{input:e,previousCharIndex:n,previousValue:o,currentValue:r,value:a,char:c}=this,l=i(o,s,c).length<i(r,s,c).length?n+1:n;this.init().value=h(i(a,s,c),t,c),e.setSelectionRange(l,l)}charHandler(t,s){const{value:e,template:n}=this;this.init().value=h(i(e,n,s),n,t)}get previousCharIndex(){return this.reverseCharIndexes.find(t=>this.selectionStart>t)||this.charIndexes[0]}get value(){return this.currentValue}set value(t){const{char:s,hidden:i,input:h}=this,e=t.indexOf(s);this.currentValue=t,h.value=i&&e>-1?t.substring(0,e):t}handleMouseDown(){this.mouseDown=!0}handleTouchStart(){this.touchStart=!0}handleFocus(){const{input:t,template:s,char:o,mouseDown:r,touchStart:a,previousValue:c}=this;this.value=h(i(this.value,s,o),s,this.char),(r||a)&&(this.mouseDown=!1,this.touchStart=!1,e.isNullOrEmpty(c)&&n(0).then(()=>{const s=t.value.indexOf(o);this.input.setSelectionRange(s,s)})),n(0).then(()=>{const s=t.value.indexOf(o),i=s<0?t.value.length:s;this.input.setSelectionRange(s<0?0:i,i)})}handleKeyDown(t){const{banned:s,hidden:e,template:n,char:o,charIndexes:r,selectionStart:a}=this;t.key&&1===t.key.length&&s&&s.test(t.key)&&!(t.altKey||t.ctrlKey||t.metaKey)&&t.preventDefault(),this.previousValue=e?h(i(t.target.value,n,o),n,o):t.target.value,this.selectionStart=t.target.selectionStart,this.selectionEnd=t.target.selectionEnd,this.currentCharIndex=r.findIndex(t=>t===a)}handleInput(t){const{input:s,template:n,char:o,regex:r,previousValue:a,banned:c,selectionStart:l,selectionEnd:u,currentCharIndex:d,previousCharIndex:p,charIndexes:m,reverseCharIndexes:f}=this;if(new RegExp(this.char).test(this.previousValue)||"insertFromPaste"===t.inputType||"deleteContentBackward"===t.inputType||"deleteContentForward"===t.inputType||l!==u)if("insertFromPaste"===t.inputType&&navigator.clipboard.readText().then(t=>{if(!c.test(t)){let e=a;if(l<u){const t=f.find(t=>t<=l-1),s=f.find(t=>t<=u-1),r=m.findIndex(s=>s===t),c=m.findIndex(t=>t===s),d=i(a,n,o),p=d.substring(0,r+1)+d.substring(c+1,a.length);e=h(p,n,o)}const r=m.find(t=>t>=l),c=this.charIndexes.findIndex(t=>t===r),d=i(e,n,o);e=d.substring(0,c)+t+d.substring(c,a.length),this.value=h(e,n,this.char);const p=m[c+t.length]||this.value.indexOf(o)||this.value.length;s.setSelectionRange(p,p)}}),"deleteContentBackward"!==t.inputType){if("deleteContentForward"===t.inputType){const t=m.find(t=>t>=l),e=m.findIndex(s=>s===t),r=i(a,n,o),c=r.substring(0,e)+r.substring(e+1,a.length);return this.value=h(c,n,o),void s.setSelectionRange(l,l)}if(!(t.altKey||t.ctrlKey||t.metaKey)){if(!t.data||e.exists(r[d])&&!r[d].test(t.data))return this.value=a,void s.setSelectionRange(l,l);if(a.charAt(l)===o||l===n.length){const e=i(a,n,o);this.value=h(e+t.data,n,o);const r=this.value.indexOf(o),c=r<0?n.length:r;s.setSelectionRange(c,c)}else{let e=a;if(l<u){const t=f.find(t=>t<=l-1),s=f.find(t=>t<=u-1),r=m.findIndex(s=>s===t),c=m.findIndex(t=>t===s),d=i(a,n,o),p=d.substring(0,r+1)+d.substring(c+1,a.length);e=h(p,n,o)}const r=m.find(t=>t>=l),c=this.charIndexes.findIndex(t=>t===r),d=i(e,n,o);e=d.substring(0,c)+t.data+d.substring(c,a.length);const p=m.find(t=>t>r);this.value=h(e,n,this.char),s.setSelectionRange(p,p)}}}else{const t=f.find(t=>t<=l-1),e=f.find(t=>t<=u-1),r=m.findIndex(s=>s===t),c=m.findIndex(t=>t===e),d=i(a,n,o);if(r<c){const t=d.substring(0,r+1)+d.substring(c+1,a.length);this.value=h(t,n,o),t&&r>-1?s.setSelectionRange(p+1,p+1):s.setSelectionRange(p,p)}else{const t=d.substring(0,r)+d.substring(c+1,a.length);this.value=h(t,n,o),s.setSelectionRange(p,p)}}else this.value=a}componentWillLoad(){this.input=document.getElementById(this.for),this.input.addEventListener("focus",this.handleFocus),this.input.addEventListener("keydown",this.handleKeyDown),this.input.addEventListener("input",this.handleInput),this.input.addEventListener("mousedown",this.handleMouseDown),this.input.addEventListener("touchstart",this.handleTouchStart)}disconnectedCallback(){this.input&&this.input.removeEventListener&&(this.input.removeEventListener("focus",this.handleFocus),this.input.removeEventListener("keydown",this.handleKeyDown),this.input.removeEventListener("input",this.handleInput),this.input.removeEventListener("mousedown",this.handleMouseDown),this.input.removeEventListener("touchstart",this.handleTouchStart))}render(){return s("slot",null)}static get watchers(){return{template:["templateHandler"],char:["charHandler"]}}};o.style=":host{display:none}";export{o as ku4_mask}