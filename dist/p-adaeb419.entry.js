import{r as t,h as s}from"./p-80e7f1ae.js";import{u as i,c as e,Z as h,t as n}from"./p-ce48150b.js";const o=class{constructor(s){t(this,s),this.charIndexes=[],this.reverseCharIndexes=[],this.previousValue="",this.ban="",this.pattern="",this.char="_",this.handleFocus=this.handleFocus.bind(this),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleInput=this.handleInput.bind(this),this.charIndexes=this.template.split("").reduce((t,s,i)=>(s===this.char&&t.push(i),t),[]),this.reverseCharIndexes=[...this.charIndexes].reverse(),this.banned=this.ban&&new RegExp(this.ban),this.regex=this.pattern&&this.pattern.substr(1).split(this.pattern[0]).map(t=>t&&new RegExp(t)||null)}get previousCharIndex(){return this.reverseCharIndexes.find(t=>this.selectionStart>t)||this.charIndexes[0]}handleFocus(){const{input:t,template:s,char:n}=this;t.value=i(e(t.value,s,n),s,this.char),h(0).then(()=>{const s=t.value.indexOf(n),i=s>-1?s:t.value.length;this.input.setSelectionRange(i,i)})}handleKeyDown(t){t.key&&1===t.key.length&&this.banned&&this.banned.test(t.key)&&!(t.altKey||t.ctrlKey||t.metaKey)&&t.preventDefault(),this.previousValue=t.target.value,this.selectionStart=t.target.selectionStart,this.selectionEnd=t.target.selectionEnd,this.currentCharIndex=this.charIndexes.findIndex(t=>t===this.selectionStart)}handleInput(t){const{input:s,template:h,char:o,regex:r,previousValue:c,selectionStart:a,selectionEnd:l,currentCharIndex:d,previousCharIndex:u,charIndexes:p,reverseCharIndexes:f}=this;if(!(t.altKey||t.ctrlKey||t.metaKey))if(new RegExp(this.char).test(t.target.value)||"deleteContentBackward"===t.inputType||"deleteContentForward"===t.inputType)if("deleteContentBackward"===t.inputType){const t=f.find(t=>t<=a-1),n=f.find(t=>t<=l-1),r=p.findIndex(s=>s===t),d=p.findIndex(t=>t===n),w=e(c,h,o);if(r<d){const t=w.substring(0,r+1)+w.substring(d+1,c.length);s.value=i(t,h,o),t?s.setSelectionRange(u+1,u+1):s.setSelectionRange(u,u)}else{const t=w.substring(0,r)+w.substring(d+1,c.length);s.value=i(t,h,o),s.setSelectionRange(u,u)}}else if("deleteContentForward"===t.inputType){const t=p.find(t=>t>=a),n=p.findIndex(s=>s===t),r=e(c,h,o),l=r.substring(0,n)+r.substring(n+1,c.length);s.value=i(l,h,o),s.setSelectionRange(a,a)}else{if(n.exists(r[d])&&!r[d].test(t.data))return s.value=c,void s.setSelectionRange(a,a);if(c.charAt(a)===o||a===h.length){const n=e(c,h,o);s.value=i(n+t.data,h,this.char);const r=s.value.indexOf(o);s.setSelectionRange(r,r)}else{const n=a+1,r=this.charIndexes.findIndex(t=>t===a),l=e(c,h,o),d=l.substring(0,r)+t.data+l.substring(r,c.length);s.value=i(d,h,this.char),s.setSelectionRange(n,n)}}else s.value=c}componentWillLoad(){this.input=document.getElementById(this.for),this.input.addEventListener("focus",this.handleFocus),this.input.addEventListener("keydown",this.handleKeyDown),this.input.addEventListener("input",this.handleInput)}disconnectedCallback(){this.input.removeEventListener("focus",this.handleFocus),this.input.removeEventListener("keydown",this.handleKeyDown),this.input.removeEventListener("input",this.handleInput)}render(){return s("slot",null)}};o.style=":host{display:none}";export{o as ku4_mask}