import{r as t,c as i,h as s,g as h}from"./p-558f5446.js";import{Y as n,o,t as a}from"./p-54fb5b7d.js";import{i as e}from"./p-5d8e9dd5.js";const r=class{constructor(s){t(this,s),this.didValidate=i(this,"validate",7),this.valid=void 0,this.invalid=void 0,this.validate=this.validate.bind(this),this.handleReset=this.handleReset.bind(this)}async listFieldNames(){return e.readFieldNames(this.form)}async validate(){const{fields:t}=this,i=t.map((t=>t.validate()));return this.isValid=await Promise.all(i).then((t=>!t.some((t=>!1===t)))),this.valid=this.isValid,this.invalid=!this.isValid,await n(100).then((()=>{const t=[].slice.call(this.form.querySelectorAll("ku4-validation[invalid]")),i=[].slice.call(document.querySelectorAll(`[form="${this.form.id}"]`)).map((t=>document.querySelector(`ku4-validation[invalid][for="${t.id}"]`))),s=[].slice.call(document.querySelectorAll(`ku4-validation[invalid][form="${this.form.id}"]`));return o(t.concat(i).concat(s).filter((t=>a.exists(t))))})).then((t=>this.didValidate.emit({invalid:t}))),this.isValid}async invalidate(t){if(a.isArray(t))t.forEach((t=>{const i=this.fields.find((i=>i.for===t));i&&(i.invalid=!0)}));else{const i=this.fields.find((i=>i.for===t));i&&(i.invalid=!0)}return this.isValid=!1,this.valid=this.isValid,this.invalid=!this.isValid,this}async read(){return e.read(this.form)}async write(t){return e.write(this.form,t),Object.keys(t).forEach((t=>{try{this.form.querySelector(`[name="${t}"]`).dispatchEvent(new window.Event("change"))}catch(i){}})),this}async focusFirstInvalid(){n(100).then((()=>{const t=document.querySelector("ku4-validation[invalid]");a.exists(t)&&t.scrollIntoView({behavior:"smooth",block:"center"})}))}get form(){return this.host.querySelector("form")}get fields(){const t=[].slice.call(this.form.querySelectorAll("ku4-validation")),i=[].slice.call(document.querySelectorAll(`[form="${this.form.id}"]`)).map((t=>document.querySelector(`ku4-validation[for="${t.id}"]`))),s=[].slice.call(document.querySelectorAll(`ku4-validation[form="${this.form.id}"]`));return o(t.concat(i).concat(s).filter((t=>a.exists(t))))}handleReset(){this.isValid=!0,this.valid=this.isValid,this.invalid=!this.isValid}componentWillLoad(){const{form:t}=this;if(a.exists(t)){const i=t.onsubmit||(()=>{});t.onsubmit=s=>(s.preventDefault(),this.validate().then((h=>h&&i.call(t,s))).then((i=>!a.isFalse(i)&&t.submit())),!1),t.addEventListener("reset",this.handleReset),this.fields.forEach((t=>t.addEventListener("validated",this.validate)))}}disconnectedCallback(){const{form:t}=this;a.exists(t)&&(t.removeEventListener("reset",this.handleReset),this.fields.forEach((t=>t.removeEventListener("validated",this.validate))))}render(){return s("slot",null)}get host(){return h(this)}};export{r as ku4_form}