import{r as t,h as s,g as i}from"./p-d5339fd8.js";import{a as e}from"./p-c4eeb48f.js";import{a as h,b as n}from"./p-c139569b.js";const a=(t,s)=>{t.forEach(s?t=>{t.currentAriaHidden=t.getAttribute("aria-hidden"),t.setAttribute("aria-hidden",s)}:t=>{t.currentAriaHidden?t.removeAttribute("aria-hidden"):t.setAttribute("aria-hidden",t.currentAriaHidden)})},o=t=>[].slice.call(t.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')),d=class{constructor(s){t(this,s),this.active=!1,this.include="null",this.exclude="null",this.initial="null"}activeHandler(t){t?this.handleActivate():this.handleDeactivate()}async activate(t){this.lastActiveElement=t,this.active=!0}async deactivate(){this.active=!1}handleActivate(){this.lastActiveElement=this.lastActiveElement||document.activeElement,this.addEventListeners(this.elements),a(this.outerElements,!0),this.elements[0]&&(document.querySelector(this.initial)||this.elements[0]).focus()}handleDeactivate(){this.removeEventListeners(this.elements),a(this.outerElements),this.lastActiveElement.focus(),this.lastActiveElement=null}async handleKeyDown(t){if(h.tab.didFire(t)&&this.focusableElements.includes(t.target)){const s=this.focusableElements.indexOf(t.target);return t.target.blur(),t.shiftKey?0===s?this.focusableElements[this.focusableElements.length-1].focus():this.focusableElements[s-1].focus():s===this.focusableElements.length-1?this.focusableElements[0].focus():this.focusableElements[s+1].focus(),n.mute(t)}}handleMouse(t){this.elements.some(s=>s===t.target)||n.mute(t)}addEventListeners(t){t.forEach(t=>t.addEventListener("keydown",this.handleKeyDown,!0)),t.forEach(t=>t.addEventListener("keyup",n.mute,!0)),t.forEach(t=>t.addEventListener("keypress",n.mute,!0)),window.addEventListener("click",this.handleMouse,!0),window.addEventListener("mouseup",this.handleMouse,!0),window.addEventListener("mousedown",this.handleMouse,!0)}removeEventListeners(t){t.forEach(t=>t.removeEventListener("keydown",this.handleKeyDown,!0)),t.forEach(t=>t.removeEventListener("keyup",n.mute,!0)),t.forEach(t=>t.removeEventListener("keypress",n.mute,!0)),window.removeEventListener("click",this.handleMouse,!0),window.removeEventListener("mouseup",this.handleMouse,!0),window.removeEventListener("mousedown",this.handleMouse,!0)}clearTimeout(){this.timeout&&this.timeout.clear()}componentDidLoad(){this.handleKeyDown=this.handleKeyDown.bind(this),this.handleMouse=this.handleMouse.bind(this),n.mute=n.mute.bind(this)}componentDidRender(){const t=[].slice.call(document.querySelectorAll(this.include)||[]),s=[].slice.call(document.querySelectorAll(this.exclude)||[]);var i;this.elements=[...(i=this.host,[].slice.call(i.querySelectorAll(':not([tabindex="-1"])'))),...t].reduce((t,s)=>(t.includes(s)||t.push(s),t),[]);const h=["A","BUTTON","INPUT","SELECT","TEXTAREA"];this.focusableElements=this.elements.reduce((t,s)=>((t=>{const s=t.getAttribute("tabindex");return(h.includes(t.tagName.toUpperCase())||t.getAttribute("href"))&&(!s||isNaN(s)||parseInt(s)>-1)})(s)&&t.push(s),t),[]);const n=[].slice.call(this.host.querySelectorAll("*"));this.outerElements=[...o(document.body),...s].filter(s=>!(s===this.host||n.includes(s)||t.includes(s))),this.active&&(this.clearTimeout(),this.timeout=new e(100).onTimeout(()=>this.handleActivate()).start())}componentDidUnload(){this.active&&this.handleDeactivate(),this.clearTimeout()}render(){return s("slot",null)}get host(){return i(this)}static get watchers(){return{active:["activeHandler"]}}static get style(){return":host{position:static!important}"}};export{d as ku4_focus_trap};