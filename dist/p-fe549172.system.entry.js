var __awaiter=this&&this.__awaiter||function(t,e,n,r){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,s){function a(t){try{u(r.next(t))}catch(e){s(e)}}function o(t){try{u(r["throw"](t))}catch(e){s(e)}}function u(t){t.done?n(t.value):i(t.value).then(a,o)}u((r=r.apply(t,e||[])).next())}))};var __generator=this&&this.__generator||function(t,e){var n={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol==="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(t){return function(e){return u([t,e])}}function u(a){if(r)throw new TypeError("Generator is already executing.");while(n)try{if(r=1,i&&(s=a[0]&2?i["return"]:a[0]?i["throw"]||((s=i["return"])&&s.call(i),0):i.next)&&!(s=s.call(i,a[1])).done)return s;if(i=0,s)a=[a[0]&2,s.value];switch(a[0]){case 0:case 1:s=a;break;case 4:n.label++;return{value:a[1],done:false};case 5:n.label++;i=a[1];a=[0];continue;case 7:a=n.ops.pop();n.trys.pop();continue;default:if(!(s=n.trys,s=s.length>0&&s[s.length-1])&&(a[0]===6||a[0]===2)){n=0;continue}if(a[0]===3&&(!s||a[1]>s[0]&&a[1]<s[3])){n.label=a[1];break}if(a[0]===6&&n.label<s[1]){n.label=s[1];s=a;break}if(s&&n.label<s[2]){n.label=s[2];n.ops.push(a);break}if(s[2])n.ops.pop();n.trys.pop();continue}a=e.call(t,n)}catch(o){a=[6,o];i=0}finally{r=s=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:true}}};var __spreadArrays=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var s=arguments[e],a=0,o=s.length;a<o;a++,i++)r[i]=s[a];return r};System.register(["./p-ea4f0c53.system.js","./p-d74a6f64.system.js","./p-44397fa0.system.js"],(function(t){"use strict";var e,n,r,i,s,a,o;return{setters:[function(t){e=t.r,n=t.h,r=t.g},function(t){i=t.t,s=t.o},function(t){a=t.p,o=t.b}],execute:function(){var u=function(t,e){e?t.forEach((function(t){t.currentAriaHidden=t.getAttribute("aria-hidden"),t.setAttribute("aria-hidden",e)})):t.forEach((function(t){t.currentAriaHidden?t.setAttribute("aria-hidden",t.currentAriaHidden):t.removeAttribute("aria-hidden")}))},l=["A","BUTTON","INPUT","SELECT","TEXTAREA"],c=function(t){return[].slice.call(t.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'))},h=o.tab,d=o.tab.shift,f=o.tab.alt,p=o.tab.alt.shift;t("ku4_focus_trap",function(){function t(t){e(this,t),this.iframes=[],this.active=!1,this.handleKeyDown=this.handleKeyDown.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this),this.handleMouse=this.handleMouse.bind(this)}t.prototype.activeHandler=function(t){t?this.handleActivate():this.handleDeactivate()};t.prototype.activate=function(t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){this.lastActiveElement=t||document.querySelector(this.return||null),this.active=!0;return[2]}))}))};t.prototype.deactivate=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(t){this.active=!1;return[2]}))}))};t.prototype.handleActivate=function(){var t=this;this.lastActiveElement=this.lastActiveElement||document.activeElement,this.lastActiveElement&&this.lastActiveElement.blur&&this.lastActiveElement.blur(),this.addEventListeners(this.elements),u(this.outerElements,!0),window.requestAnimationFrame((function(){var e=document.querySelector(t.initial||null)||t.focusableElements[0]||t.trapElements[0];e.blur(),e.focus(),t.activateTraps()}))};t.prototype.handleDeactivate=function(){this.removeEventListeners(this.elements),this.deactivateTraps(),u(this.outerElements),this.lastActiveElement&&this.lastActiveElement.focus&&this.lastActiveElement.focus(),this.lastActiveElement=null};t.prototype.handleKeyDown=function(t){if(d.didFire(t)||p.didFire(t))try{if(this.iframes.length>0&&(this.trapElements[1]===t.target||!i.isNull(t.target.getAttribute("ku4-focus-wrap"))||this.iframes.some((function(e){return e.contains(t.target)}))))return;if(this.trapElements[0]===t.target)return this.trapElements[1].focus(),a.mute(t);var e=this.focusableElements.indexOf(t.target)-1,n=e<0?this.focusableElements.length-1:e;return this.focusableElements[n].focus(),a.mute(t)}catch(t){return a.mute(t)}if(h.didFire(t)||f.didFire(t))try{if(this.iframes.length>0&&(this.trapElements[0]===t.target||!i.isNull(t.target.getAttribute("ku4-focus-wrap"))||this.iframes.some((function(e){return e.contains(t.target)}))))return;if(this.trapElements[1]===t.target)return this.trapElements[0].focus(),a.mute(t);var r=this.focusableElements.indexOf(t.target)+1,s=r>=this.focusableElements.length?0:r;return this.focusableElements[s].focus(),a.mute(t)}catch(t){return a.mute(t)}};t.prototype.handleKeyUp=function(t){var e=this.trapElements.indexOf(t.target);if(0===e&&(d.didFire(t)||p.didFire(t))){return(this.focusableElements[this.focusableElements.length-1]||this.trapElements[1]).focus(),a.mute(t)}if(1===e&&(h.didFire(t)||f.didFire(t))){return(this.focusableElements[0]||this.trapElements[0]).focus(),a.mute(t)}};t.prototype.handleMouse=function(t){this.elements.some((function(e){return e===t.target}))||a.mute(t)};t.prototype.addEventListeners=function(t){var e=this;t.forEach((function(t){return t.addEventListener("keydown",e.handleKeyDown,!0)})),t.forEach((function(t){return t.addEventListener("keyup",e.handleKeyUp,!0)})),window.addEventListener("click",this.handleMouse,!0),window.addEventListener("mousedown",this.handleMouse,!0),window.addEventListener("mouseup",this.handleMouse,!0),window.addEventListener("touchstart",this.handleMouse,!0)};t.prototype.removeEventListeners=function(t){var e=this;t.forEach((function(t){return t.removeEventListener("keydown",e.handleKeyDown,!0)})),t.forEach((function(t){return t.removeEventListener("keyup",e.handleKeyUp,!0)})),window.removeEventListener("click",this.handleMouse,!0),window.removeEventListener("mousedown",this.handleMouse,!0),window.removeEventListener("mouseup",this.handleMouse,!0),window.addEventListener("touchstart",this.handleMouse,!0)};t.prototype.activateTraps=function(){this.setTraps(0)};t.prototype.deactivateTraps=function(){this.setTraps(-1)};t.prototype.setTraps=function(t){[].slice.call(this.host.querySelectorAll("[ku4-focus-trap], [ku4-focus-wrap]")).forEach((function(e){return e.setAttribute("tabindex",t)}))};t.prototype.wrap=function(t){var e=document.createDocumentFragment();e.appendChild(this.createWrapTag()),e.appendChild(t.cloneNode()),e.appendChild(this.createWrapTag()),t.parentNode.replaceChild(e,t)};t.prototype.createTrapTag=function(){return this.createTag("ku4-focus-trap")};t.prototype.createWrapTag=function(){return this.createTag("ku4-focus-wrap")};t.prototype.createTag=function(t){var e=document.createElement("button");return e.setAttribute(t,""),e.setAttribute("tabindex","0"),e.setAttribute("aria-hidden","true"),e.style.position="static",e.style.display="block",e.style.width="0",e.style.height="0",e.style.margin="0",e.style.padding="0",e.style.border="none",e.style.outline="none",e};t.prototype.initialize=function(){var t=this;var e=[].slice.call(this.host.querySelectorAll("*")),n=[].slice.call(document.querySelectorAll(this.include||null)||[]),r=[].slice.call(document.querySelectorAll(this.exclude)||[]);var a=[];var o;(this.excludeShadow||"").split(",").forEach((function(t){if(!i.isNullOrEmpty(t))try{var e=t.trim().replace(/\s/,"|").split("|"),r=document.querySelector(e[0]).shadowRoot.querySelectorAll(e[1]);a=a.concat([].slice.call(r||[]))}catch(n){console.error("Invalid shadow selector",t)}})),this.iframes=[].slice.call(this.host.querySelectorAll("iframe")||[]),this.iframes.forEach((function(e){return t.wrap(e)})),this.elements=s(__spreadArrays((o=this.host,[].slice.call(o.querySelectorAll(':not([tabindex="-1"])'))),n)),this.focusableElements=this.elements.reduce((function(e,n){return function(t){var e=t.getAttribute("tabindex");return(l.includes(t.tagName.toUpperCase())||t.getAttribute("href"))&&(!e||isNaN(e)||parseInt(e)>-1)}(n)&&!t.trapElements.includes(n)&&e.push(n),e}),[]),this.outerElements=__spreadArrays(c(document.body),r,a).filter((function(r){return!(r===t.host||e.includes(r)||n.includes(r))}))};t.prototype.componentDidLoad=function(){var t=this.createTrapTag(),e=this.createTrapTag();this.trapElements=[t,e],this.host.insertBefore(t,this.host.firstChild),this.host.appendChild(e),this.initialize(),this.active?this.handleActivate():this.handleDeactivate()};t.prototype.disconnectedCallback=function(){this.active&&this.handleDeactivate()};t.prototype.render=function(){return n("slot",null)};Object.defineProperty(t.prototype,"host",{get:function(){return r(this)},enumerable:false,configurable:true});Object.defineProperty(t,"watchers",{get:function(){return{active:["activeHandler"]}},enumerable:false,configurable:true});return t}()).style=":host{position:static}"}}}));