var __spreadArrays=this&&this.__spreadArrays||function(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var a=arguments[e],s=0,u=a.length;s<u;s++,i++)r[i]=a[s];return r};import{r as registerInstance,h}from"./index-dc6f4989.js";import{o,u,Z,t}from"./index-aa88697c.js";var ku4MaskCss=":host{display:none}";var Ku4Mask=function(){function e(t){registerInstance(this,t);this.charIndexes=[];this.reverseCharIndexes=[];this.previousValue="";this.currentValue="";this.touchStart=false;this.template="";this.ban="";this.pattern="";this.char="_";this.hidden=false;this.handleFocus=this.handleFocus.bind(this);this.handleKeyDown=this.handleKeyDown.bind(this);this.handleInput=this.handleInput.bind(this);this.handleTouchStart=this.handleTouchStart.bind(this);this.init()}e.prototype.init=function(){var t=this;this.chars=this.char&&new RegExp(this.char);this.banned=this.ban&&new RegExp(this.ban);var e=this.pattern.replace(/[\s\n]/gm,"");this.patterns=e.substr(1).split(e[0]).map((function(t){try{return t&&new RegExp(t)||null}catch(e){}}));this.charIndexes=this.template.split("").reduce((function(e,n,r){if(t.chars.test(n)){e.push(r)}return e}),[]);this.reverseCharIndexes=__spreadArrays(this.charIndexes).reverse();return this};e.prototype.templateHandler=function(t,e){var n=this,r=n.input,i=n.previousCharIndex,a=n.previousValue,s=n.currentValue,h=n.value,l=n.char;var c=o(a,e,l).length;var d=o(s,e,l).length;var v=c<d?i+1:i;this.init().value=u(o(h,e,l),t,l);r.setSelectionRange(v,v)};e.prototype.charHandler=function(t,e){var n=this,r=n.value,i=n.template;this.init().value=u(o(r,i,e),i,t)};Object.defineProperty(e.prototype,"previousCharIndex",{get:function(){var t=this;return this.reverseCharIndexes.find((function(e){return t.selectionStart>e}))||this.charIndexes[0]},enumerable:false,configurable:true});Object.defineProperty(e.prototype,"value",{get:function(){return this.currentValue},set:function(t){var e=this,n=e.chars,r=e.hidden,i=e.input;var a=t.search(n);this.currentValue=t;i.value=r&&a>-1?t.substring(0,a):t},enumerable:false,configurable:true});e.prototype.handleTouchStart=function(){this.touchStart=true};e.prototype.handleFocus=function(){var t=this;var e=this,n=e.input,r=e.template,i=e.char,a=e.chars,s=e.touchStart;this.value=u(o(this.value,r,i),r,i);Z(0).then((function(){var e=n.value.search(a);var r=e<0?n.value.length:e;t.input.setSelectionRange(e<0&&!s?0:r,r);t.touchStart=false}))};e.prototype.handleKeyDown=function(t){var e=this,n=e.banned,r=e.hidden,i=e.template,a=e.char;if(t.key&&t.key.length===1&&n&&(n.test(t.key)&&!(t.altKey||t.ctrlKey||t.metaKey))){t.preventDefault()}this.previousValue=r?u(o(t.target.value,i,a),i,a):t.target.value;this.selectionStart=t.target.selectionStart;this.selectionEnd=t.target.selectionEnd};e.prototype.handleInput=function(e){var n=this;var r=this,i=r.input,a=r.template,s=r.char,h=r.chars,l=r.previousValue,c=r.banned,d=r.selectionStart,v=r.selectionEnd,p=r.previousCharIndex,f=r.patterns,g=r.charIndexes,y=r.reverseCharIndexes;if(!h.test(this.previousValue)&&e.inputType!=="insertFromPaste"&&e.inputType!=="deleteContentBackward"&&e.inputType!=="deleteContentForward"&&d===v){this.value=l;return}if(e.inputType==="insertFromPaste"){try{navigator.clipboard.readText().then((function(e){var r=e.replace(new RegExp(c,"g"),"");if(t.isNullOrEmpty(r)){n.value=l;i.setSelectionRange(d,d);return}if(!c||!c.test(r)){var p=l;if(d<v){var f=y.find((function(t){return t<=d-1}));var b=y.find((function(t){return t<=v-1}));var m=g.findIndex((function(t){return t===f}));var x=g.findIndex((function(t){return t===b}));var I=o(l,a,s);var S=I.substring(0,m+1)+I.substring(x+1,l.length);p=u(S,a,s)}var E=g.find((function(t){return t>=d}));var R=g.findIndex((function(t){return t===E}));var k=o(p,a,s);p=k.substring(0,R)+r+k.substring(R,l.length);n.value=u(p,a,s);var w=g[R+r.length]||n.value.search(h)||n.value.length;i.setSelectionRange(w,w)}}));this.value=l;i.setSelectionRange(d,d);return}catch(e){this.value=l;i.setSelectionRange(d,d);return}}if(e.inputType==="deleteContentBackward"){var b=y.find((function(t){return t<=d-1}));var m=y.find((function(t){return t<=v-1}));var x=g.findIndex((function(t){return t===b}));var I=g.findIndex((function(t){return t===m}));var S=o(l,a,s);if(x<I){var E=S.substring(0,x+1)+S.substring(I+1,l.length);this.value=u(E,a,s);E&&x>-1?i.setSelectionRange(p+1,p+1):i.setSelectionRange(p,p)}else{var E=S.substring(0,x)+S.substring(I+1,l.length);this.value=u(E,a,s);i.setSelectionRange(p,p)}return}if(e.inputType==="deleteContentForward"){var R=g.find((function(t){return t>=d}));var k=g.findIndex((function(t){return t===R}));var S=o(l,a,s);var E=S.substring(0,k)+S.substring(k+1,l.length);this.value=u(E,a,s);i.setSelectionRange(d,d);return}if(e.altKey||e.ctrlKey||e.metaKey){return}if(!e.data){this.value=l;i.setSelectionRange(d,d);return}if(h.test(l.charAt(d))||d===a.length){var S=o(l,a,s);this.value=u(S+e.data,a,s);var w=this.value.search(h);var C=w<0?a.length:w;i.setSelectionRange(C,C);var K=g.findIndex((function(t){return t>=C}));var T=K<0?g.length-1:K-1;this.validate(e.data,f[T])}else{var L=l;if(d<v){var V=y.find((function(t){return t<=d-1}));var F=y.find((function(t){return t<=v-1}));var x=g.findIndex((function(t){return t===V}));var I=g.findIndex((function(t){return t===F}));var _=o(l,a,s);var E=_.substring(0,x+1)+_.substring(I+1,l.length);L=u(E,a,s)}var D=g.find((function(t){return t>=d}));var k=g.findIndex((function(t){return t===D}));var S=o(L,a,s);L=S.substring(0,k)+e.data+S.substring(k,l.length);var j=g.find((function(t){return t>D}));this.value=u(L,a,s);i.setSelectionRange(j,j);var K=g.findIndex((function(t){return t>=j}));var T=K<0?g.length-1:K-1;this.validate(e.data,f[T])}};e.prototype.validate=function(e,n){var r=this,i=r.previousValue,a=r.input,s=r.value,u=r.selectionStart;if(t.exists(n)&&!(n.test(e)||/\(\?[!<=]/.test(n.toString())&&n.test(s))){this.value=i;a.setSelectionRange(u,u)}};e.prototype.componentWillLoad=function(){this.input=document.getElementById(this.for);this.input.addEventListener("focus",this.handleFocus);this.input.addEventListener("keydown",this.handleKeyDown);this.input.addEventListener("input",this.handleInput);this.input.addEventListener("touchstart",this.handleTouchStart)};e.prototype.disconnectedCallback=function(){if(this.input&&this.input.removeEventListener){this.input.removeEventListener("focus",this.handleFocus);this.input.removeEventListener("keydown",this.handleKeyDown);this.input.removeEventListener("input",this.handleInput);this.input.removeEventListener("touchstart",this.handleTouchStart)}};e.prototype.render=function(){return h("slot",null)};Object.defineProperty(e,"watchers",{get:function(){return{template:["templateHandler"],char:["charHandler"]}},enumerable:false,configurable:true});return e}();Ku4Mask.style=ku4MaskCss;export{Ku4Mask as ku4_mask};