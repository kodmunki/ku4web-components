import{r as t,h as i,g as s}from"./p-d5339fd8.js";import{a as e}from"./p-c4eeb48f.js";import{a as h,b as n}from"./p-c139569b.js";const a=(t,i)=>{t.forEach(i?t=>{t.currentAriaHidden=t.getAttribute("aria-hidden"),t.setAttribute("aria-hidden",i)}:t=>{t.currentAriaHidden?t.removeAttribute("aria-hidden"):t.setAttribute("aria-hidden",t.currentAriaHidden)})},o=t=>[].slice.call(t.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')),d=class{constructor(i){t(this,i),this.active=!1,this.include="null",this.exclude="null",this.initial="null"}activeHandler(t){t?this.handleActivate():this.handleDeactivate()}async activate(t){this.lastActiveElement=t,this.active=!0}async deactivate(){this.active=!1}handleActivate(){this.lastActiveElement=this.lastActiveElement||document.activeElement,this.addEventListeners(this.elements),a(this.outerElements,!0),this.elements[0]&&(document.querySelector(this.initial)||this.elements[0]).focus()}handleDeactivate(){this.removeEventListeners(this.elements),a(this.outerElements),this.lastActiveElement.focus(),this.lastActiveElement=null}async handleKeyDown(t){if(h.tab.didFire(t)&&this.focusableElements.includes(t.target)){const i=this.focusableElements.indexOf(t.target);return t.target.blur(),t.shiftKey?0===i?await this.focusableElements[this.focusableElements.length-1].focus():await this.focusableElements[i-1].focus():i===this.focusableElements.length-1?await this.focusableElements[0].focus():await this.focusableElements[i+1].focus(),n.mute(t)}}handleMouse(t){this.elements.some(i=>i===t.target)||n.mute(t)}addEventListeners(t){t.forEach(t=>t.addEventListener("keydown",this.handleKeyDown,!0)),t.forEach(t=>t.addEventListener("keyup",n.mute,!0)),t.forEach(t=>t.addEventListener("keypress",n.mute,!0)),window.addEventListener("click",this.handleMouse,!0),window.addEventListener("mouseup",this.handleMouse,!0),window.addEventListener("mousedown",this.handleMouse,!0)}removeEventListeners(t){t.forEach(t=>t.removeEventListener("keydown",this.handleKeyDown,!0)),t.forEach(t=>t.removeEventListener("keyup",n.mute,!0)),t.forEach(t=>t.removeEventListener("keypress",n.mute,!0)),window.removeEventListener("click",this.handleMouse,!0),window.removeEventListener("mouseup",this.handleMouse,!0),window.removeEventListener("mousedown",this.handleMouse,!0)}clearTimeout(){this.timeout&&this.timeout.clear()}componentDidLoad(){this.handleKeyDown=this.handleKeyDown.bind(this),this.handleMouse=this.handleMouse.bind(this),n.mute=n.mute.bind(this)}componentDidRender(){const t=[].slice.call(document.querySelectorAll(this.include)||[]),i=[].slice.call(document.querySelectorAll(this.exclude)||[]);var s;this.elements=[...(s=this.host,[].slice.call(s.querySelectorAll(':not([tabindex="-1"])'))),...t].reduce((t,i)=>(t.includes(i)||t.push(i),t),[]);const h=["A","BUTTON","INPUT","SELECT","TEXTAREA"];this.focusableElements=this.elements.reduce((t,i)=>((t=>{const i=t.getAttribute("tabindex");return(h.includes(t.tagName.toUpperCase())||t.getAttribute("href"))&&(!i||isNaN(i)||parseInt(i)>-1)})(i)&&t.push(i),t),[]);const n=[].slice.call(this.host.querySelectorAll("*"));this.outerElements=[...o(document.body),...i].filter(i=>!(i===this.host||n.includes(i)||t.includes(i))),this.active&&(this.clearTimeout(),this.timeout=new e(100).onTimeout(()=>this.handleActivate()).start())}componentDidUnload(){this.active&&this.handleDeactivate(),this.clearTimeout()}render(){return i("slot",null)}get host(){return s(this)}static get watchers(){return{active:["activeHandler"]}}static get style(){return":host{position:static!important}"}};export{d as ku4_focus_trap};